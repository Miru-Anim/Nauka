DROP DATABASE IF EXISTS a7x_dyskografia;
CREATE DATABASE a7x_dyskografia;
USE a7x_dyskografia;

CREATE TABLE czlonkowie_zespolu (
    id_czlonek INT AUTO_INCREMENT PRIMARY KEY,
    imie VARCHAR(50),
    nazwisko VARCHAR(50),
    pseudonim VARCHAR(50),
    data_urodzenia DATE,
    kraj_pochodzenia VARCHAR(100)
);

CREATE TABLE instrumenty (
    id_instrument INT AUTO_INCREMENT PRIMARY KEY,
    nazwa VARCHAR(100)
);

CREATE TABLE czlonek_instrument (
    id INT AUTO_INCREMENT PRIMARY KEY,
    czlonek_id INT,
    instrument_id INT,
    data_od DATE,
    data_do DATE,
    FOREIGN KEY (czlonek_id) REFERENCES czlonkowie_zespolu(id_czlonek),
    FOREIGN KEY (instrument_id) REFERENCES instrumenty(id_instrument)
);

CREATE TABLE albumy (
    id_album INT AUTO_INCREMENT PRIMARY KEY,
    tytul_albumu VARCHAR(150) NOT NULL,
    data_wydania DATE,
    wytwornia VARCHAR(100),
    typ_albumu VARCHAR(50),
    czas_trwania TIME
);

CREATE TABLE udzial_w_albumie (
    id_udzial INT AUTO_INCREMENT PRIMARY KEY,
    album_id INT,
    czlonek_id INT,
    rola VARCHAR(100),
    FOREIGN KEY (album_id) REFERENCES albumy(id_album),
    FOREIGN KEY (czlonek_id) REFERENCES czlonkowie_zespolu(id_czlonek)
);

CREATE TABLE utwory (
    id_utwor INT AUTO_INCREMENT PRIMARY KEY,
    album_id INT,
    tytul_utworu VARCHAR(150),
    nr_sciezki INT,
    dlugosc TIME,
    FOREIGN KEY (album_id) REFERENCES albumy(id_album)
);

CREATE TABLE autorzy_utworow (
    id INT AUTO_INCREMENT PRIMARY KEY,
    utwor_id INT,
    czlonek_id INT,
    rola VARCHAR(100),
    FOREIGN KEY (utwor_id) REFERENCES utwory(id_utwor),
    FOREIGN KEY (czlonek_id) REFERENCES czlonkowie_zespolu(id_czlonek)
);

CREATE TABLE producenci (
    id_producent INT AUTO_INCREMENT PRIMARY KEY,
    imie VARCHAR(50),
    nazwisko VARCHAR(50),
    pseudonim VARCHAR(50)
);

CREATE TABLE album_producent (
    id INT AUTO_INCREMENT PRIMARY KEY,
    album_id INT,
    producent_id INT,
    FOREIGN KEY (album_id) REFERENCES albumy(id_album),
    FOREIGN KEY (producent_id) REFERENCES producenci(id_producent)
);

CREATE TABLE gatunki (
    id_gatunek INT AUTO_INCREMENT PRIMARY KEY,
    nazwa VARCHAR(100)
);

CREATE TABLE album_gatunek (
    id INT AUTO_INCREMENT PRIMARY KEY,
    album_id INT,
    gatunek_id INT,
    FOREIGN KEY (album_id) REFERENCES albumy(id_album),
    FOREIGN KEY (gatunek_id) REFERENCES gatunki(id_gatunek)
);

CREATE TABLE nagrody (
    id_nagroda INT AUTO_INCREMENT PRIMARY KEY,
    nazwa VARCHAR(150),
    organizacja VARCHAR(150)
);

CREATE TABLE album_nagroda (
    id INT AUTO_INCREMENT PRIMARY KEY,
    album_id INT,
    nagroda_id INT,
    rok INT,
    wynik VARCHAR(50), -- wygrana / nominacja
    FOREIGN KEY (album_id) REFERENCES albumy(id_album),
    FOREIGN KEY (nagroda_id) REFERENCES nagrody(id_nagroda)
);

CREATE TABLE trasy_koncertowe (
    id_trasa INT AUTO_INCREMENT PRIMARY KEY,
    nazwa_trasy VARCHAR(150),
    rok_rozpoczecia INT,
    rok_zakonczenia INT
);

CREATE TABLE koncerty (
    id_koncert INT AUTO_INCREMENT PRIMARY KEY,
    trasa_id INT,
    data_koncertu DATE,
    miasto VARCHAR(100),
    kraj VARCHAR(100),
    miejsce VARCHAR(150),
    FOREIGN KEY (trasa_id) REFERENCES trasy_koncertowe(id_trasa)
);

CREATE TABLE goscie (
    id_gosc INT AUTO_INCREMENT PRIMARY KEY,
    imie VARCHAR(50),
    nazwisko VARCHAR(50),
    instrument VARCHAR(100)
);

CREATE TABLE utwor_gosc (
    id INT AUTO_INCREMENT PRIMARY KEY,
    utwor_id INT,
    gosc_id INT,
    FOREIGN KEY (utwor_id) REFERENCES utwory(id_utwor),
    FOREIGN KEY (gosc_id) REFERENCES goscie(id_gosc)
);

CREATE VIEW a7x_pelne_dane AS
SELECT
    -- ALBUM
    a.id_album,
    a.tytul_albumu,
    a.data_wydania,
    a.wytwornia,
    a.typ_albumu,
    a.czas_trwania,

    -- UTWÓR
    u.id_utwor,
    u.tytul_utworu,
    u.nr_sciezki,
    u.dlugosc AS dlugosc_utworu,

    -- CZŁONEK ZESPOŁU
    cz.id_czlonek,
    cz.imie,
    cz.nazwisko,
    cz.pseudonim,
    cz.data_urodzenia,
    cz.kraj_pochodzenia,

    -- ROLA NA ALBUMIE
    ua.rola AS rola_w_albumie,

    -- AUTORSTWO UTWORU
    au.rola AS rola_w_utworze,

    -- INSTRUMENT
    i.nazwa AS instrument,

    -- PRODUCENT
    p.pseudonim AS producent,

    -- GATUNEK
    g.nazwa AS gatunek,

    -- NAGRODY
    n.nazwa AS nagroda,
    n.organizacja,
    an.rok AS rok_nagrody,
    an.wynik,

    -- TRASA KONCERTOWA
    tk.nazwa_trasy,
    tk.rok_rozpoczecia,
    tk.rok_zakonczenia,

    -- KONCERT
    k.data_koncertu,
    k.miasto,
    k.kraj,
    k.miejsce,

    -- GOŚCIE W UTWORACH
    go.imie AS gosc_imie,
    go.nazwisko AS gosc_nazwisko,
    go.instrument AS instrument_goscia

FROM albumy a
LEFT JOIN utwory u ON u.album_id = a.id_album
LEFT JOIN udzial_w_albumie ua ON ua.album_id = a.id_album
LEFT JOIN czlonkowie_zespolu cz ON cz.id_czlonek = ua.czlonek_id
LEFT JOIN autorzy_utworow au ON au.utwor_id = u.id_utwor AND au.czlonek_id = cz.id_czlonek
LEFT JOIN czlonek_instrument ci ON ci.czlonek_id = cz.id_czlonek
LEFT JOIN instrumenty i ON i.id_instrument = ci.instrument_id
LEFT JOIN album_producent ap ON ap.album_id = a.id_album
LEFT JOIN producenci p ON p.id_producent = ap.producent_id
LEFT JOIN album_gatunek ag ON ag.album_id = a.id_album
LEFT JOIN gatunki g ON g.id_gatunek = ag.gatunek_id
LEFT JOIN album_nagroda an ON an.album_id = a.id_album
LEFT JOIN nagrody n ON n.id_nagroda = an.nagroda_id
LEFT JOIN koncerty k ON k.trasa_id IN (SELECT id_trasa FROM trasy_koncertowe tk2 WHERE tk2.id_trasa = k.trasa_id)
LEFT JOIN trasy_koncertowe tk ON tk.id_trasa = k.trasa_id
LEFT JOIN utwor_gosc ug ON ug.utwor_id = u.id_utwor
LEFT JOIN goscie go ON go.id_gosc = ug.gosc_id;


USE a7x_dyskografia;

-- 1. CZŁONKOWIE ZESPOŁU
INSERT INTO czlonkowie_zespolu (imie, nazwisko, pseudonim, data_urodzenia, kraj_pochodzenia) VALUES
('M. Shadow', 'Sanders', 'M. Shadows', '1981-07-31', 'USA'),
('Zacky', 'Baker', 'Zacky Vengeance', '1981-12-11', 'USA'),
('Synyster', 'Gates', 'Synyster Gates', '1981-07-07', 'USA'),
('Johnny', 'Seward', 'Johnny Christ', '1984-11-18', 'USA'),
('Jimmy', 'Sullivan', 'The Rev', '1981-02-09', 'USA'),
('Brooks', 'Wackerman', NULL, '1977-02-15', 'USA');

-- 2. INSTRUMENTY
INSERT INTO instrumenty (nazwa) VALUES 
('Wokal'), ('Gitara rytmiczna'), ('Gitara prowadząca'), ('Perkusja'), ('Gitara basowa'), ('Fortepian');

-- 3. ALBUMY
INSERT INTO albumy (id_album, tytul_albumu, data_wydania, wytwornia, typ_albumu, czas_trwania) VALUES
(1, 'Sounding the Seventh Trumpet', '2001-01-31', 'Good Life', 'Studyjny', '00:52:22'),
(2, 'Waking the Fallen', '2003-08-26', 'Hopeless', 'Studyjny', '01:08:31'),
(3, 'City of Evil', '2005-06-07', 'Warner Bros.', 'Studyjny', '01:13:17'),
(4, 'Avenged Sevenfold', '2007-10-30', 'Warner Bros.', 'Studyjny', '00:53:50'),
(5, 'Nightmare', '2010-07-27', 'Warner Bros.', 'Studyjny', '01:06:56'),
(6, 'Hail to the King', '2013-08-27', 'Warner Bros.', 'Studyjny', '00:53:20'),
(7, 'The Stage', '2016-10-28', 'Capitol', 'Studyjny', '01:13:42'),
(8, 'Life Is But a Dream...', '2023-06-02', 'Warner Records', 'Studyjny', '00:53:21');

-- 4. UTWORY (Przykładowe z wybranych albumów)
INSERT INTO utwory (album_id, tytul_utworu, nr_sciezki, dlugosc) VALUES
-- Sounding the Seventh Trumpet
(1, 'To End the Rapture', 1, '00:01:24'), (1, 'Turn the Other Way', 2, '00:05:37'), (1, 'Darkness Surrounding', 3, '00:04:49'), (1, 'The Art of Subconscious Illusion', 4, '00:03:45'), (1, 'We Come Out at Night', 5, '00:04:45'), (1, 'Lips of Deceit', 6, '00:04:09'), (1, 'Warmness on the Soul', 7, '00:04:20'), (1, 'An Epic of Time Wasted', 8, '00:04:18'), (1, 'Breaking Their Hold', 9, '00:01:12'), (1, 'Forgotten Faces', 10, '00:03:26'), (1, 'Thick and Thin', 11, '00:02:43'), (1, 'Shattered by Broken Dreams', 12, '00:07:08'), (1, 'Streets', 13, '00:03:06'),

-- Waking the Fallen
(2, 'Waking the Fallen', 1, '00:01:42'), (2, 'Unholy Confessions', 2, '00:04:43'), (2, 'Chapter Four', 3, '00:05:42'), (2, 'Remenissions', 4, '00:06:06'), (2, 'Desecrate Through Reverence', 5, '00:05:38'), (2, 'Eternal Rest', 6, '00:05:12'), (2, 'I Won\'t See You Tonight Part 1', 7, '00:08:58'), (2, 'I Won\'t See You Tonight Part 2', 8, '00:04:44'), (2, 'Clairvoyant Disease', 9, '00:04:59'), (2, 'And All Things Will End', 10, '00:07:40'),

-- City of Evil
(3, 'Beast and the Harlot', 1, '00:05:41'), (3, 'Burn It Down', 2, '00:04:58'), (3, 'Blinded in Chains', 3, '00:06:34'), (3, 'Bat Country', 4, '00:05:13'), (3, 'Trashed and Scattered', 5, '00:05:53'), (3, 'Seize the Day', 6, '00:05:32'), (3, 'Sidewinder', 7, '00:07:01'), (3, 'The Wicked End', 8, '00:07:10'), (3, 'Strength of the World', 9, '00:09:14'), (3, 'Betrayed', 10, '00:06:47'), (3, 'M.I.A.', 11, '00:08:46'),

-- Avenged Sevenfold (Self-Titled)
(4, 'Critical Acclaim', 1, '00:05:14'), (4, 'Almost Easy', 2, '00:03:54'), (4, 'Scream', 3, '00:04:48'), (4, 'Afterlife', 4, '00:05:53'), (4, 'Gunslinger', 5, '00:04:11'), (4, 'Unbound (The Wild Ride)', 6, '00:05:11'), (4, 'Brompton Cocktail', 7, '00:04:13'), (4, 'Lost', 8, '00:05:02'), (4, 'A Little Piece of Heaven', 9, '00:08:00'), (4, 'Dear God', 10, '00:06:33'),

-- Nightmare
(5, 'Nightmare', 1, '00:06:16'), (5, 'Welcome to the Family', 2, '00:04:05'), (5, 'Danger Line', 3, '00:05:28'), (5, 'Buried Alive', 4, '00:06:44'), (5, 'Natural Born Killer', 5, '00:05:15'), (5, 'So Far Away', 6, '00:05:26'), (5, 'God Hates Us', 7, '00:05:19'), (5, 'Victim', 8, '00:07:29'), (5, 'Tonight the World Dies', 9, '00:04:43'), (5, 'Fiction', 10, '00:05:12'), (5, 'Save Me', 11, '00:10:57'),

-- Hail to the King
(6, 'Shepherd of Fire', 1, '00:05:23'), (6, 'Hail to the King', 2, '00:05:04'), (6, 'Doing Time', 3, '00:03:27'), (6, 'This Means War', 4, '00:06:09'), (6, 'Requiem', 5, '00:04:23'), (6, 'Crimson Day', 6, '00:04:57'), (6, 'Heretic', 7, '00:04:55'), (6, 'Coming Home', 8, '00:06:26'), (6, 'Planets', 9, '00:05:56'), (6, 'Acid Rain', 10, '00:06:38'),

-- The Stage
(7, 'The Stage', 1, '00:08:32'), (7, 'Paradigm', 2, '00:04:18'), (7, 'Sunny Disposition', 3, '00:06:41'), (7, 'God Damn', 4, '00:03:41'), (7, 'Creating God', 5, '00:05:34'), (7, 'Angels', 6, '00:05:40'), (7, 'Simulation', 7, '00:05:30'), (7, 'Higher', 8, '00:06:28'), (7, 'Roman Sky', 9, '00:05:00'), (7, 'Fermi Paradox', 10, '00:06:30'), (7, 'Exist', 11, '00:15:41'),

-- Life Is But a Dream...
(8, 'Game Over', 1, '00:03:46'), (8, 'Mattel', 2, '00:05:30'), (8, 'Nobody', 3, '00:05:53'), (8, 'We Love You', 4, '00:06:15'), (8, 'Cosmic', 5, '00:07:31'), (8, 'Beautiful Morning', 6, '00:05:00'), (8, 'Easier', 7, '00:03:37'), (8, 'G', 8, '00:03:37'), (8, '(O)rdinary', 9, '00:02:52'), (8, '(D)eath', 10, '00:03:00'), (8, 'Life Is But a Dream...', 11, '00:04:29');

-- 5. GATUNKI
INSERT INTO gatunki (nazwa) VALUES 
('Heavy Metal'), ('Hard Rock'), ('Metalcore'), ('Progressive Metal');

-- 6. RELACJA ALBUM - GATUNEK
INSERT INTO album_gatunek (album_id, gatunek_id) VALUES
(1, 3), -- Sounding the Seventh Trumpet - Metalcore
(2, 3), -- Waking the Fallen - Metalcore
(3, 1), -- City of Evil - Heavy Metal
(4, 1), -- Avenged Sevenfold - Heavy Metal 
(5, 1), -- Nightmare - Heavy Metal
(6, 1), -- Hail to the King - Heavy Metal
(7, 4), -- The Stage - Progressive Metal
(8, 4); -- Life Is But a Dream... - Progressive Metal (Avant-garde)


-- 7. PRZYPISANIE INSTRUMENTÓW DO CZŁONKÓW
INSERT INTO czlonek_instrument (czlonek_id, instrument_id, data_od) VALUES
(1, 1, '1999-01-01'), -- Shadows - Wokal
(2, 2, '1999-01-01'), -- Zacky - Gitara
(3, 3, '2001-01-01'), -- Syn - Gitara
(4, 5, '2002-01-01'), -- Johnny - Bas
(5, 4, '1999-01-01'), -- The Rev - Perkusja
(6, 4, '2015-01-01'); -- Brooks - Perkusja

-- 8. PRODUCENCI
INSERT INTO producenci (imie, nazwisko, pseudonim) VALUES
('Andrew', 'Murdock', 'Mudrock'),
('Mike', 'Elizondo', NULL);

-- 9. RELACJA ALBUM - PRODUCENT
INSERT INTO album_producent (album_id, producent_id) VALUES
(1, 1), -- Sounding the Seventh Trumpet - Mudrock
(2, 1), -- Waking the Fallen - Mudrock
(3, 1), -- City of Evil - Mudrock
(4, NULL), -- Self-Titled (produkcja własna zespołu)
(5, 2), -- Nightmare - Mike Elizondo
(6, 2), -- Hail to the King - Mike Elizondo
(7, 3), -- The Stage - Joe Barresi
(8, 3); -- Life Is But a Dream... - Joe Barresi

-- 10. NAGRODY
INSERT INTO nagrody (nazwa, organizacja) VALUES
('Best New Artist', 'MTV Video Music Awards'),
('Golden God', 'Metal Hammer');

-- 11. PRZYZNANIE NAGRÓD
INSERT INTO album_nagroda (album_id, nagroda_id, rok, wynik) VALUES
(2, 1, 2006, 'Wygrana');